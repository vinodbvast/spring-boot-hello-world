pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                // Checkout code from Git
                script {
                    checkout([$class: 'GitSCM', 
                      branches: [[name: 'dev']], // Assuming you want to checkout the 'dev' branch
                      userRemoteConfigs: [[
                        credentialsId: 'vinodbvast', // Specify your Git credentials ID
                        url: 'https://github.com/vinodbvast/spring-boot-hello-world.git'
                      ]]
                    ])
                }
            }
        }
        stage('Configure Git') {
            steps {
                script {
                    // Set Git user and email for this pipeline
                    sh "git config user.email 'vinodb@valueaddsofttech.com'"
                    sh "git config user.name 'vinodb'"
                }
            }
        }
        stage('Build') {
            steps {
                // Build a Java project using Maven
                sh 'mvn clean package' // Replace with your Maven goals
            }
        }
        stage('Tag Artifact') {
            when {
                expression { currentBuild.resultIsBetterOrEqualTo('SUCCESS') }
            }
            steps {
                script {
                    // Create a tag with the build version
                    def version = "${BUILD_NUMBER}"
                    sh "git tag -a v${version} -m 'Tagging for build ${version}'"
                    sh "git push origin v${version}"
                }
            }
        }
    }
    post {
        success {
            emailext (
                to: 'vinodb@valueaddsofttech.com',
                subject: "Build Succeeded for ${currentBuild.fullDisplayName}",
                body: "The build succeeded."
            )
        }
        failure {
            emailext (
                to: 'vinodb@valueaddsofttech.com',
                subject: "Build Failed for ${currentBuild.fullDisplayName}",
                body: "The build failed. Please investigate."
            )
        }
    }
}
